"use strict";var lc=lc||{};lc.Cache={enable:!0,files:{},add:function(e,t){var r=this,a=!1;return!1!==r.enable&&(r.files[e]=t,a=!0),a},get:function(e){return this.files[e]}};var lc=lc||{};!function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;lc.Class=function(){},lc.Class.extend=function(r){function a(){!e&&this.init&&this.init.apply(this,arguments)}var o=this.prototype;e=!0;var n=new this;e=!1;for(var s in r)n[s]="function"==typeof r[s]&&"function"==typeof o[s]&&t.test(r[s])?function(e,t){return function(){var r=this._super;this._super=o[e];var a=t.apply(this,arguments);return this._super=r,a}}(s,r[s]):r[s];return a.prototype=n,a.prototype.constructor=a,a.extend=lc.Class.extend,a}}();var lc=lc||{};lc.Core={launch:function(e,t,r){lc.EngineStart(e,t,r,function(){var e=lc.Project.getProjectData(),t=e.ResourceText.projectSetting.defaultSceneID,r=lc.Project.getResourceBySceneId(t);lc.Loader.load(r,function(){console.log("load finished");var r=[{type:"script",url:APIRoot+"gf/sdk/GenJs?userid="+USERID+"&projectid="+PROJECTID+"&isglobal=1"}];lc.Loader.load(r,function(){var r=[{type:"script",url:APIRoot+"gf/sdk/GenTpl/"+e.FrameworkVersion+"/2d/RenderScene?userid="+USERID+"&projectid="+PROJECTID+"&sceneid="+t}];lc.Loader.load(r,function(){console.log("load render scene finished.")})})})})}};var lc=lc||{};lc.LoaderBase=lc.Class.extend({times:5,init:function(){},load:function(e,t,r){var a=this,o=lc.Cache.get(e);if(o)return t&&t(cached),o;a.tryLoad(e,t,r,0)},tryLoad:function(e,t,r,a){}}),lc.ImageLoader=lc.LoaderBase.extend({init:function(){this._super()},tryLoad:function(e,t,r,a){var o=this,n=new Image;n.addEventListener("load",function(){lc.Cache.add(e,this),t&&t(this)},!1),n.addEventListener("error",function(){a<o.times?o.tryLoad(e,t,r,a++):r&&r(event)},!1),n.src=e}}),lc.imageLoaderInstance=new lc.ImageLoader,lc.ScriptLoader=lc.LoaderBase.extend({init:function(){this._super()},tryLoad:function(e,t,r,a){var o=this,n=document.createElement("script"),s=null,c=null;n.async=!1,s=function(){lc.Cache.add(e,!0),t&&t(this),n.parentNode&&n.parentNode.removeChild(n),n.removeEventListener("load",s,!1),n.removeEventListener("error",c,!1)},c=function(){n.parentNode&&n.parentNode.removeChild(n),n.removeEventListener("load",s,!1),n.removeEventListener("error",c,!1),a<o.times?o.tryLoad(e,t,r,a++):r&&r(event)},n.addEventListener("load",s,!1),n.addEventListener("error",c,!1),n.src=e,document.body.appendChild(n)}}),lc.scriptLoaderInstance=new lc.ScriptLoader,lc.audioLoader=lc.LoaderBase.extend({init:function(){this._super()},tryLoad:function(e,t,r,a){var o=null,n=Audio?new Audio(""):document.createElement("audio"),s=function(){o&&window.clearTimeout(o),lc.Cache.add(e,!0),t&&t(this),i()},c=function(){r&&r(event),i()},i=function(){n.removeEventListener("loadedmetadata",s,!1),n.removeEventListener("error",c,!1)};o=setTimeout(function(){console.log("load:"+e+" time out."),r&&r(event),i()},3e4),n.addEventListener("loadedmetadata",s,!1),n.addEventListener("error",c,!1),n.src=e}}),lc.audioLoaderInstance=new lc.audioLoader,lc.Loader={loaders:{image:lc.imageLoaderInstance,script:lc.scriptLoaderInstance,audio:lc.audioLoaderInstance},load:function(e,t){for(var r=this,a=0,o=function(r){++a>=e.length&&t&&t()},n=function(r){r&&console.log(r),++a>=e.length&&t&&t()},s=0;s<e.length;s++){var c=e[s],i=r.loaders[c.type];i&&i.load(c.url,o,n)}}};var lc=lc||{};lc.Object={};var lc=lc||{};lc.Project={_projectData:null,_resource:null,prepare:function(e){var t=this,r=lc.Util.getXMLHttpRequest(),a=null;a="pid=fe1bf410-2965-11e7-ab3f-cba729ac7ef0",r.open("POST","http://10.57.220.76:12000/op//gf/webapi/ReadProject_Preview"),r.setRequestHeader("Content-Type","application/x-www-form-urlencodeed;charset=UTF-8");r.onreadystatechange=function(){if(4==r.readyState&&(200==r.status||0==r.status)){var a=r.responseText||'{"state":"ok","projectinfo":{"name":"userInterface","owner":"24289509306817014","ProjectText":{"version":0.91,"editorVersion":2,"owner":"24289509306817014","users":[],"project":"","name":"userInterface","ptype":0,"structure":{"sences":{},"objects":{}},"packages":{"base":["Base"],"extra":[]}},"ResourceText":{"version":0.91,"curranimationId":200000,"currresId":300002,"currprototypeId":400000,"currlogicId":500002,"currsceneId":600000,"currScene":600000,"currmapId":700000,"currparticleId":800000,"currvariableId":1000000,"currloadingId":2000000,"wraperId":0,"owner":"24289509306817014","project":"","name":"userInterface","resolution":{"adapterMode":"2","width":"640","height":"1136"},"logicPlugin":[],"structure":{"currentTabs":[{"id":"page1","path":"/素材","title":"素材","state":true},{"id":"page2","path":"/动画","title":"动画","state":true},{"id":"page3","path":"/逻辑","title":"逻辑","state":true},{"id":"page4","path":"/原型","title":"原型","state":true},{"id":"page5","path":"/场景","title":"场景","state":true},{"id":"page6","path":"/地图","title":"地图","state":true},{"id":"page7","path":"/数据","title":"数据","state":true}],"resources":{"/":{"d":["素材","动画","逻辑","原型","场景","地图","数据"],"f":[]},"/素材":{"d":["图片","影音","数据"],"f":[]},"/素材/图片":{"d":[],"f":[300001]},"/素材/影音":{"d":[],"f":[300002]},"/素材/数据":{"d":[],"f":[]},"/动画":{"d":[],"f":[]},"/逻辑":{"d":[],"f":[500001,500002]},"/原型":{"d":[],"f":[]},"/场景":{"d":[],"f":["600000"]},"/地图":{"d":[],"f":[]},"/数据":{"d":[],"f":[]}}},"origin":{"resources":{"300001":{"resType":"image","resURL":"/images/e86307d2be74cffb5e565f2867be4502.png","size":11264,"width":357,"height":103},"300002":{"resType":"audio","resURL":"/material/sounds/4/a38508d01e41ac879180c2e44e64013d.mp3","size":322560,"width":0,"height":0},"500001":{"resType":"logic","data":{"data":[[{"argu":["2","200000","360",false],"block":[[]],"pos":{"left":78,"top":158},"type":"ac-runRotates","resources":[]},{"argu":["1",100000,"2",false],"block":[[{"argu":["1","200000","1",false],"block":[[]],"pos":{},"type":"ac-runScales","resources":[]}]],"pos":{"left":78,"top":158},"type":"ac-runScales","resources":[]}]],"local":[]},"md5":"7ae23c1ebdbd58530791b95a9ae06def"},"500002":{"resType":"logic","data":{"data":[[{"argu":["2","320","850",null],"block":[[]],"pos":{"left":46,"top":240},"type":"ac-runEaseInOutMoving","resources":[]}]],"local":[]},"md5":"5def5d700efbaf590ef0a929cf02f61d"},"600000":{"resType":"scene","data":{"gameSetting":[{"id":"b00f220b-89e7-4254-be90-2bc639956574","child":[]},{"id":"133b2e5f-d990-446d-a75d-60cf55114d37","child":[]}],"instance":{"b00f220b-89e7-4254-be90-2bc639956574":{"components":{"Transform":[{"propertys":{"objectName":"Logo","transform":{"Position":{"x":"320.00","y":"568.00","z":"0.00"},"Scale":{"x":"1.00","y":"1.00"},"Rotation":{"x":"0.00","y":0}},"alpha":100,"group":"默认"},"id":1,"enabled":true}],"Texture":[{"propertys":{"file":{"id":"300001","name":"logo.png"},"blendFunc":0},"id":2,"enabled":true}],"Event":[{"propertys":{"EventType":0,"file":{"name":"逻辑2","id":"500002"}},"id":3,"enabled":true}]},"wraperName":"Logo","lockState":0,"resources":[{"number":1,"resId":"300001"},{"number":1,"resId":"500001"},{"number":1,"resId":"500002"}]},"133b2e5f-d990-446d-a75d-60cf55114d37":{"components":{"Transform":[{"propertys":{"objectName":"音频","transform":{"Position":{"x":"245.84","y":"210.01","z":"0.00"},"Scale":{"x":"1.00","y":"1.00"},"Rotation":{"x":"0.00","y":0}},"alpha":100,"group":"默认"},"id":1,"enabled":true}],"Audio":[{"propertys":{"src":{"id":"300002","name":"格式工厂游戏中背景音乐.mp3"},"playType":0,"Volume":100,"autoPlay":true,"isLoop":false},"id":2,"enabled":true}]},"wraperName":"音频","lockState":null,"resources":[{"number":1,"resId":"300002"}]}},"arInstance":{}}}}},"projectSetting":{"gameEngine":"crafty","defaultSceneID":"600000","resolution":{"adapterMode":"2","width":"640","height":"1136"},"id":"75067a90-2fe3-11e7-821f-d36a32f88b9c","owner":"24289509306817014"}},"FrameworkVersion":"2.1","Type":"1","version":{"oldVersion":0.91,"version":0.91}}}',o=JSON.parse(a);"ok"==o.state&&(t._projectData=o.projectinfo,t._resources=o.projectinfo.ResourceText.origin.resources),e&&e()}},r.send(a)},getProjectData:function(){return this._projectData},getResourceForKey:function(e){return this._resource[e]},getResourceInstance:function(e,t){var r=[];for(var a in t){var o=t[a];if(o.resources)for(var n=0;n<o.resources.length;n++){var s=o.resources[n].resId?o.resources[n].resId:o.resources[n],c=e[s];if(c)if("logic"===c.resType);else if("image"===c.resType)r.push({type:"image",url:ResRoot+c.resURL.substr(1)});else if("audio"===c.resType)r.push({type:"audio",url:ResRoot+c.resURL.substr(1)});else if("fnt"===c.resType)r.push({type:"fnt",url:ResRoot+c.resURL.substr(1)});else if("applciation"===c.resType)r.push({type:"application",url:ResRoot+c.resURL.substr(1)});else if("map"===c.resTYpe)for(var i=c.data.mapBlock,d=0;d<i.length;d++){var u=i[d];r.push({type:"image",url:ResRoot+u.src.substr(1)})}}}return r},getResourceBySceneId:function(e){var t=this,r=[],a=t._resources,o=a[e];if(o){var n=o.data.instance;r=t.getResourceInstance(a,n)}return r}};var lc=lc||{};lc.Util={getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")}};