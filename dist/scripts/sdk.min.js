"use strict";var lc=lc||{};lc.Cache={enable:!0,files:{},add:function(e,t){var r=this,n=!1;return!1!==r.enable&&(r.files[e]=t,n=!0),n},get:function(e){return this.files[e]}};var lc=lc||{},ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};!function(){var e=/\b_super\b/;lc.Class=function(){},lc.Class.extend=function(t){function r(){this.__instanceId=ClassManager.getNewInstanceId(),this.ctor&&this.ctor.apply(this,arguments)}var n=this.prototype,a=Object.create(n),o=ClassManager.getNewID();ClassManager[o]=n;var s={writable:!0,enumerable:!1,configurable:!0};a.__instanceId=null,r.id=o,s.value=o,Object.defineProperty(a,"__pid",s),r.prototype=a,s.value=r,Object.defineProperty(r.prototype,"constructor",s),this.__getters__&&(r.__getters__=lc.clone(this.__getters__)),this.__setters__&&(r.__setters__=lc.clone(this.__setters__));for(var c=0,i=arguments.length;c<i;++c){var l=arguments[c];for(var d in l){var u="function"==typeof l[d],f="function"==typeof n[d],p=e.test(l[d]);if(u&&f&&p?(s.value=function(e,t){return function(){var r=this._super;this._super=n[e];var a=t.apply(this,arguments);return this._super=r,a}}(d,l[d]),Object.defineProperty(a,d,s)):u?(s.value=l[d],Object.defineProperty(a,d,s)):a[d]=l[d],u){var _,h,g;if(this.__getters__&&this.__getters__[d]){g=this.__getters__[d];for(var v in this.__setters__)if(this.__setters__[v]===g){h=v;break}lc.defineGetterSetter(a,g,l[d],l[h]?l[h]:a[h],d,h)}if(this.__setters__&&this.__setters__[d]){g=this.__setters__[d];for(var v in this.__getters__)if(this.__getters__[v]===g){_=v;break}lc.defineGetterSetter(a,g,l[_]?l[_]:a[_],l[d],_,d)}}}}return r.extend=lc.Class.extend,r.implement=function(e){for(var t in e)a[t]=e[t]},r}}(),lc.defineGetterSetter=function(e,t,r,n,a,o){if(e.__defineGetter__)r&&e.__defineGetter__(t,r),n&&e.__defineSetter__(t,n);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var s={enumerable:!1,configurable:!0};r&&(s.get=r),n&&(s.set=n),Object.defineProperty(e,t,s)}if(!a&&!o)for(var c=null!=r,i=void 0!=n,l=Object.getOwnPropertyNames(e),d=0;d<l.length;d++){var u=l[d];if((e.__lookupGetter__?!e.__lookupGetter__(u):!Object.getOwnPropertyDescriptor(e,u))&&"function"==typeof e[u]){var f=e[u];if(c&&f===r&&(a=u,!i||o))break;if(i&&f===n&&(o=u,!c||a))break}}var p=e.constructor;a&&(p.__getters__||(p.__getters__={}),p.__getters__[a]=t),o&&(p.__setters__||(p.__setters__={}),p.__setters__[o]=t)},lc.clone=function(e){var t=e.constructor?new e.constructor:{};for(var r in e){var n=e[r];"object"!=typeof n||!n||n instanceof HTMLElement?t[r]=n:t[r]=lc.clone(n)}return t},lc.inject=function(e,t){for(var r in e)t[r]=e[r]};var lc=lc||{};lc.Core={launch:function(e,t,r){lc.EngineStart(e,t,r,function(){var e=lc.Project.getProjectData(),t=e.ResourceText.projectSetting.defaultSceneID,r=lc.Project.getResourceBySceneId(t);lc.Loader.load(r,function(){console.log("load finished");var r=[{type:"script",url:APIRoot+"gf/sdk/GenJs?userid="+USERID+"&projectid="+PROJECTID+"&isglobal=1"}];lc.Loader.load(r,function(){var r=[{type:"script",url:APIRoot+"gf/sdk/GenTpl/"+e.FrameworkVersion+"/2d/RenderScene?userid="+USERID+"&projectid="+PROJECTID+"&sceneid="+t}];lc.Loader.load(r,function(){console.log("load render scene finished.")})})})})}};var lc=lc||{};lc.LoaderBase=lc.Class.extend({times:5,ctor:function(){},load:function(e,t,r){var n=this,a=lc.Cache.get(e);if(a)return t&&t(cached),a;n.tryLoad(e,t,r,0)},tryLoad:function(e,t,r,n){}}),lc.ImageLoader=lc.LoaderBase.extend({ctor:function(){this._super()},tryLoad:function(e,t,r,n){var a=this,o=new Image;o.addEventListener("load",function(){lc.Cache.add(e,this),t&&t(this)},!1),o.addEventListener("error",function(){n<a.times?a.tryLoad(e,t,r,n++):r&&r(event)},!1),o.src=e}}),lc.imageLoaderInstance=new lc.ImageLoader,lc.ScriptLoader=lc.LoaderBase.extend({ctor:function(){this._super()},tryLoad:function(e,t,r,n){var a=this,o=document.createElement("script"),s=null,c=null;o.async=!1,s=function(){lc.Cache.add(e,!0),t&&t(this),o.parentNode&&o.parentNode.removeChild(o),o.removeEventListener("load",s,!1),o.removeEventListener("error",c,!1)},c=function(){o.parentNode&&o.parentNode.removeChild(o),o.removeEventListener("load",s,!1),o.removeEventListener("error",c,!1),n<a.times?a.tryLoad(e,t,r,n++):r&&r(event)},o.addEventListener("load",s,!1),o.addEventListener("error",c,!1),o.src=e,document.body.appendChild(o)}}),lc.scriptLoaderInstance=new lc.ScriptLoader,lc.audioLoader=lc.LoaderBase.extend({ctor:function(){this._super()},tryLoad:function(e,t,r,n){var a=null,o=Audio?new Audio(""):document.createElement("audio"),s=function(){a&&window.clearTimeout(a),lc.Cache.add(e,!0),t&&t(this),i()},c=function(){r&&r(event),i()},i=function(){o.removeEventListener("loadedmetadata",s,!1),o.removeEventListener("error",c,!1)};a=setTimeout(function(){console.log("load:"+e+" time out."),r&&r(event),i()},3e4),o.addEventListener("loadedmetadata",s,!1),o.addEventListener("error",c,!1),o.src=e}}),lc.audioLoaderInstance=new lc.audioLoader,lc.Loader={loaders:{image:lc.imageLoaderInstance,script:lc.scriptLoaderInstance,audio:lc.audioLoaderInstance},load:function(e,t){for(var r=this,n=0,a=function(r){++n>=e.length&&t&&t()},o=function(r){r&&console.log(r),++n>=e.length&&t&&t()},s=0;s<e.length;s++){var c=e[s],i=r.loaders[c.type];i&&i.load(c.url,a,o)}}};var lc=lc||{};lc.Object={};var lc=lc||{};lc.Project={_projectData:null,_resource:null,prepare:function(e){var t=this,r=lc.Util.getXMLHttpRequest(),n=null;n="pid=fe1bf410-2965-11e7-ab3f-cba729ac7ef0",r.open("POST","http://10.57.220.76:12000/op//gf/webapi/ReadProject_Preview"),r.setRequestHeader("Content-Type","application/x-www-form-urlencodeed;charset=UTF-8");r.onreadystatechange=function(){if(4==r.readyState&&(200==r.status||0==r.status)){var n=r.responseText||'{"state":"ok","projectinfo":{"name":"userInterface","owner":"24289509306817014","ProjectText":{"version":0.91,"editorVersion":2,"owner":"24289509306817014","users":[],"project":"","name":"userInterface","ptype":0,"structure":{"sences":{},"objects":{}},"packages":{"base":["Base"],"extra":[]}},"ResourceText":{"version":0.91,"curranimationId":200000,"currresId":300002,"currprototypeId":400000,"currlogicId":500002,"currsceneId":600000,"currScene":600000,"currmapId":700000,"currparticleId":800000,"currvariableId":1000000,"currloadingId":2000000,"wraperId":0,"owner":"24289509306817014","project":"","name":"userInterface","resolution":{"adapterMode":"2","width":"640","height":"1136"},"logicPlugin":[],"structure":{"currentTabs":[{"id":"page1","path":"/素材","title":"素材","state":true},{"id":"page2","path":"/动画","title":"动画","state":true},{"id":"page3","path":"/逻辑","title":"逻辑","state":true},{"id":"page4","path":"/原型","title":"原型","state":true},{"id":"page5","path":"/场景","title":"场景","state":true},{"id":"page6","path":"/地图","title":"地图","state":true},{"id":"page7","path":"/数据","title":"数据","state":true}],"resources":{"/":{"d":["素材","动画","逻辑","原型","场景","地图","数据"],"f":[]},"/素材":{"d":["图片","影音","数据"],"f":[]},"/素材/图片":{"d":[],"f":[300001]},"/素材/影音":{"d":[],"f":[300002]},"/素材/数据":{"d":[],"f":[]},"/动画":{"d":[],"f":[]},"/逻辑":{"d":[],"f":[500001,500002]},"/原型":{"d":[],"f":[]},"/场景":{"d":[],"f":["600000"]},"/地图":{"d":[],"f":[]},"/数据":{"d":[],"f":[]}}},"origin":{"resources":{"300001":{"resType":"image","resURL":"/images/e86307d2be74cffb5e565f2867be4502.png","size":11264,"width":357,"height":103},"300002":{"resType":"audio","resURL":"/material/sounds/4/a38508d01e41ac879180c2e44e64013d.mp3","size":322560,"width":0,"height":0},"500001":{"resType":"logic","data":{"data":[[{"argu":["2","200000","360",false],"block":[[]],"pos":{"left":78,"top":158},"type":"ac-runRotates","resources":[]},{"argu":["1",100000,"2",false],"block":[[{"argu":["1","200000","1",false],"block":[[]],"pos":{},"type":"ac-runScales","resources":[]}]],"pos":{"left":78,"top":158},"type":"ac-runScales","resources":[]}]],"local":[]},"md5":"7ae23c1ebdbd58530791b95a9ae06def"},"500002":{"resType":"logic","data":{"data":[[{"argu":["2","320","850",null],"block":[[]],"pos":{"left":46,"top":240},"type":"ac-runEaseInOutMoving","resources":[]}]],"local":[]},"md5":"5def5d700efbaf590ef0a929cf02f61d"},"600000":{"resType":"scene","data":{"gameSetting":[{"id":"b00f220b-89e7-4254-be90-2bc639956574","child":[]},{"id":"133b2e5f-d990-446d-a75d-60cf55114d37","child":[]}],"instance":{"b00f220b-89e7-4254-be90-2bc639956574":{"components":{"Transform":[{"propertys":{"objectName":"Logo","transform":{"Position":{"x":"320.00","y":"568.00","z":"0.00"},"Scale":{"x":"1.00","y":"1.00"},"Rotation":{"x":"0.00","y":0}},"alpha":100,"group":"默认"},"id":1,"enabled":true}],"Texture":[{"propertys":{"file":{"id":"300001","name":"logo.png"},"blendFunc":0},"id":2,"enabled":true}],"Event":[{"propertys":{"EventType":0,"file":{"name":"逻辑2","id":"500002"}},"id":3,"enabled":true}]},"wraperName":"Logo","lockState":0,"resources":[{"number":1,"resId":"300001"},{"number":1,"resId":"500001"},{"number":1,"resId":"500002"}]},"133b2e5f-d990-446d-a75d-60cf55114d37":{"components":{"Transform":[{"propertys":{"objectName":"音频","transform":{"Position":{"x":"245.84","y":"210.01","z":"0.00"},"Scale":{"x":"1.00","y":"1.00"},"Rotation":{"x":"0.00","y":0}},"alpha":100,"group":"默认"},"id":1,"enabled":true}],"Audio":[{"propertys":{"src":{"id":"300002","name":"格式工厂游戏中背景音乐.mp3"},"playType":0,"Volume":100,"autoPlay":true,"isLoop":false},"id":2,"enabled":true}]},"wraperName":"音频","lockState":null,"resources":[{"number":1,"resId":"300002"}]}},"arInstance":{}}}}},"projectSetting":{"gameEngine":"crafty","defaultSceneID":"600000","resolution":{"adapterMode":"2","width":"640","height":"1136"},"id":"75067a90-2fe3-11e7-821f-d36a32f88b9c","owner":"24289509306817014"}},"FrameworkVersion":"2.1","Type":"1","version":{"oldVersion":0.91,"version":0.91}}}',a=JSON.parse(n);"ok"==a.state&&(t._projectData=a.projectinfo,t._resources=a.projectinfo.ResourceText.origin.resources),e&&e()}},r.send(n)},getProjectData:function(){return this._projectData},getResourceForKey:function(e){return this._resource[e]},getResourceInstance:function(e,t){var r=[];for(var n in t){var a=t[n];if(a.resources)for(var o=0;o<a.resources.length;o++){var s=a.resources[o].resId?a.resources[o].resId:a.resources[o],c=e[s];if(c)if("logic"===c.resType);else if("image"===c.resType)r.push({type:"image",url:ResRoot+c.resURL.substr(1)});else if("audio"===c.resType)r.push({type:"audio",url:ResRoot+c.resURL.substr(1)});else if("fnt"===c.resType)r.push({type:"fnt",url:ResRoot+c.resURL.substr(1)});else if("applciation"===c.resType)r.push({type:"application",url:ResRoot+c.resURL.substr(1)});else if("map"===c.resTYpe)for(var i=c.data.mapBlock,l=0;l<i.length;l++){var d=i[l];r.push({type:"image",url:ResRoot+d.src.substr(1)})}}}return r},getResourceBySceneId:function(e){var t=this,r=[],n=t._resources,a=n[e];if(a){var o=a.data.instance;r=t.getResourceInstance(n,o)}return r}};var lc=lc||{};lc.Scene=lc.Class.extend({objType:"scene",children:null,engineScene:null,ctor:function(){var e=this;e.children=[],e.engineScene=new lc.EngineScene},addChild:function(e){var t=this;if(null!==e.parent)throw new Error("child already have a parent!");e.parent=t,t.children.push(e),t.engineScene.addChild(e.engineObject)},_traverseObject:function(e,t){var r=this;if(e.tag=t)return e;if(e.children&&e.children[0])for(var n=0;n<e.length;n++){var a=r._traverseObject(e.children[n],key);if(a)return a}},getChildByTag:function(e){var t=this,r=t._traverseObject(t,e);return r=r||null},clear:function(e){for(var t=this,r=t.children.length,n=r-1;n>=0;n--)t.children[n]&&t.children[n].clear(!0);t.children.length=0,e&&t.engineScene.cleanup(),e=null},run:function(){_this.engineScene&&(_this.engineScene.run&&_this.engineScene.run(),console.log("scene run"))},update:function(){for(var e=this,t=e.children,r=t.length,n=null,a=r-1;a>=0;a--)(n=t[a])&&n.update()},onEvent:function(e){for(var t=this,r=t.children,n=r.length,a=null,o=n-1;o>=0&&(!(a=r[o])||!a.onEvent(e));o--);}});var lc=lc||{};lc.Util={getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")}};